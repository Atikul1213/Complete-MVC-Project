@model ProductSearchModel


<div class="card-body p-4">
    <form id="myForm" method="post" class="row">
        <div class="border p-3">

            <div class="form-floating py-2 col-12">
                <label asp-for="SelectedCategoryId" class="ms-2">Category</label>
                <select id="catid" asp-for="SelectedCategoryId" asp-items="Model.categoryList" class="form-select border-0 shadow">
                    <option disabled selected>
                        --Select Product--
                    </option>
                </select>
                <span asp-validation-for="SelectedCategoryId" class="text-danger"></span>
            </div>



            <div class="mb-3 row p-1">
                <label asp-for="SearchName" class="p-0">Product Name</label>
                <input id="prodname" asp-for="SearchName" class="form-control" />
                <span asp-validation-for="SearchName" class="text-danger"></span>
            </div>


        

            <div class="mb-3 row p-1">
                <label asp-for="MaxPrice" class="p-0"> </label>
                <input id="price" asp-for="MaxPrice" class="form-control" />
                <span asp-validation-for="MaxPrice" class="text-danger"></span>
            </div>



            <div class="row" pt-2>
                <div class="col-6 col-md-3">
                    <button id="mybutton" type="submit" class="btn btn-primary form-control">Search</button>
                </div>

                 

            </div>



        </div>

    </form>

</div>




<div class="container">
    <div class="row pt-4 pb-3">
        <div class="col-6">
            <h2 class="text-primary">Product List</h2>
        </div>

        <div class="col-6 text-end">
            <a asp-controller="Product" asp-action="Create" class="btn btn-primary">
                <i class="bi bi-bookmark-plus-fill"></i>Create New Product
            </a>
        </div>

    </div>

    <table id="myTable" class="table table-bordered table-striped">
        <thead>
            <tr>
                @* <th>Options</th> *@
                <th>Product Name</th>
                <th>Price</th>
                <th>CategoryName</th>

                <th></th>
            </tr>
        </thead>

        <tbody>

        </tbody>
    </table>


</div>





@section Scripts {

    <script>
        $(document).ready(function () {
             e = true,

            $("#mybutton").click(function (e) {
                e.preventDefault(); // Prevent the default form submission
                var catid = $("#catid").val();
                var prodName = $("#prodname").val();
                var price = $("#price").val();
                console.log('Successfully returned outer');
                $.ajax({
                    type: 'POST',
                    "url": "@Url.Action("GetAll", "Product")",
                    data: { catid: catid, prodName: prodName, price: price },
                    success: function (response) {
                        console.log('Successfully returned ', response.data);
                        $('#myTable tbody').empty(); // Clear the table body first
                        response.data.forEach(item => {
                            $('#myTable tbody').append(`
                                                <tr>
                                                    <td>${item.items.name}</td>
                                                    <td>${item.items.price}</td>
                                                    <td>${item.items.category.name}</td>
                                                    <td>
                                                        <div class="w-75 btn-group" role="group">
                                                            <a href="/Product/Edit/${item.items.id}" class="btn btn-primary"><i class="bi bi-pencil-fill"></i></a>
                                                            <a href="/Product/Details/${item.items.id}" class="btn btn-primary"><i class="bi bi-list-check"></i></a>
                                                            <a href="/Product/Delete/${item.items.id}" class="btn btn-danger"><i class="bi bi-trash-fill"></i></a>
                                                        </div>
                                                    </td>
                                                </tr>
                              `);
                        });
                    },
                    error: function (response) {
                        console.log('Successfully returned error');
                        alert('Error fetching quantity.');
                    }
                });



            });


        });


    </script>
}
